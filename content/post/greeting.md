+++
title = 'Облако не приговор (часть 1)'
date = 2023-12-06T22:43:16+07:00
draft = true
tags = ['bitrix24', 'облако', 'эксперементы', 'esp']
categories = ['блог']
+++

**Disclaimer**

Описанное ниже, не является руководством к действию, не испытано на практике и по сути является лишь демонстрацией возможностей облачных порталов Bitrix24.


Этот проект задумывался ещё когда порталы Bitrix24 с бесплатным тарифом позволяли использовать REST api.

**Идея**

Задумка следующая. В bitrix24 есть механизм PushAndPull (по сути это обычный websocket). Он используется для работы мессенджера, обновления данных в карточках "на лету" и обмена с 1с "в режиме реального времени".

Касательно 1с - это скорее ухищрение, к которому прибегли из-за того, что не каждую 1с есть возможность открыть наружу (да и не все хотят). Поэтому происходит следующее:

В качестве токена доступа мы вводим refresh_token (тот код что просит ввести обмен 1с)
По этому токену 1с получает данные домена (обращаясь к серверу авторизации битрикс)
По полученным авторизационным данным - получаем параметры подключения к веб-сокету
Слушаем сообщения в реальном времени
Так вот, что если, проделать тот же путь что и 1с, но в конечном итоге слушать не события битрикса для их обновления, а например, управлять устройствами умного дома?

Повторюсь. Идея бредовая. Не делайте умный дом на битрикс24. Пожалуйста. 
Нам понадобится:

- Модуль с wi-fi на борту. Я взял esp-8266 (просто потому что попался первым под руку)
- Реле (так же выбирал из того что было)
- Транзистор (не хватало мощности клацать напрямую реле, поэтому IRF-3205)
- Кнопка
- Клемма
- 3 светодиода
Всё это было собрано на макетной плате, в черновом виде, просто потому что изначально задумывалось как шалость.

Приводить схему соединения всего этого не буду, по сути транзистор подключен к выводу D6, и управляет реле. Кнопка задумывалась как сброс настроек (для включения в режиме точки доступа). Остальное ниже - по коду.

