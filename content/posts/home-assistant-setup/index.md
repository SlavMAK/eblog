+++
title = 'Home Assistant - ещё одна статья по установке'
description ='Установка Home Assistant в docker контейнере и базовые настройки'
date = 2024-06-10T18:02:22.408Z
draft = true
tags = ['HomeAssistant', 'docker', 'умный дом', 'автоматизированный дом']
categories = ['блог']
+++
## Disclaimer

Если вас задевает использование термина "умный дом" вместо "автоматизированный дом", приготовьте лёд для своевременного устранения очагов возгорания.

## Введение

В интернетах и без меня в целом хватает инструкций по установке, и когда я начинал своё знакомство с Home Assistant (далее HA) - я собрал свою коллекцию шишек к которым приводили те или иные решения. В конечном итоге, я остановился на установке HA в Docker. Эта статья - отправная точка для небольших заметок по устройствам которые я собираюсь тут оставлять.

### Почему Home Assistant
На самом деле всё просто - отталкивался от того что было под рукой. А именно - RaspberryPi 3b+ и колонка с Яндекс Алисой. И наиболее простым способом это всё подружить мне показался именно Home Assistant. На самом деле, при выборе системы, кажется единственное на что действительно стоит обратить внимание - магазин расширений, так как всё умное что вы покупаете к себе домой, будь то лампочка или чайник - хочется заводить без танцев с бубном. Меня же, помимо прочего, привлекла возможность использования <a href="https://esphome.io">ESPHome</a> - который считается нативным для HomeAssistant.
В конечном итоге, именно  ESPHome стал спасительной точкой, так как используя стандартные способы подключения, например, устройств Tuya - я столкнулся с постоянной потерей соединения. Для каких-то устройст, причиной являлась функция роутера смены канала (на наименее загруженный), для каких-то причину я выяснить так и не смог. Устройства прошитые через ESPHome - работали как часы. К тому же, теряли свою зависимость от серверов в китае.

### Почему Docker
Я достаточно долго использовал установку в виде операционной системы Home Assistant, но моей постоянной проблемой было то, что я хотел бы установить рядом что-то ещё. Да, вы можете установить многое через supervisor, но это не сравнится с той гибкостью которую даёт обычный linux. Как результат, на сервере рядом с HomeAssistant крутится ещё несколько служб:
* <a href="https://www.home-assistant.io">Home Assistant</a> - сам HA
* <a href="https://frigate.video">frigate</a> - видеорегистратор
* <a href="https://mosquitto.org/">mosquitto</a> - брокер сообщений Mqtt
* <a href="https://www.wireguard.com/">wireguard</a> - VPN для доступа к домашней сети
* <a href="https://qbittorrent.github.io">qbittorrent</a> - лично я никогда бы не установил. Торренты зло. Но если вы другого мнения...

Так же, использование Docker даёт возможность организации хранения резервных копий так, как вы считаете нужным. Я не сильно переживаю если пропадут показания счётчиков за прошлый месяц или история выключателей. Меня беспокоят лишь конфигурации. Поэтому я просто использую git, так, плюсом ко всему я могу ещё и быстро дёрнуть параметры из старых файлов.

## Установка HA
На самом деле вся установка сводится к CRTL+C, CTRL+V из инструкций, на вашу машину.
0. Устанавливаем linux. В зависимости от предпочтений.
1. <a href="https://docs.docker.com/engine/install/">Устанавливаем Docker</a> и <a href="https://docs.docker.com/compose/install/linux/"> Docker compose</a>. (Docker compose включен в комплект docker поэтому актуально не для всех)
2. Берём <a href="https://www.home-assistant.io/installation/linux/#docker-compose">конфиг для Docker Compose с официального сайта HA</a>
3. ```docker compose up``` либо ```docker-compose up``` (в зависимости от того устанавливали вы compose отдельно или он шел в комплекте)
4. ??!!Готовенько!!

Но есть нюанс. Обновлять home assistant теперь нужно так же черз docker. Для этого достаточно:
1. ```docker compose pull``` - скачать новую версию
2. ```docker compose up``` - переподнять контейнер

## HACS
HACS - сторонний магазин дополнений. Стандартных плагинов не так много, и это решает HACS. <a href="https://hacs.xyz/docs/setup/download">Ставится так же по инструкции</a>.

